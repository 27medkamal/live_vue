{
  "version": 3,
  "sources": ["../../assets/js/live_vue/hooks.js", "../../assets/js/live_vue/use.js"],
  "sourcesContent": ["import { createApp, createSSRApp, reactive, h, ref, computed } from 'vue'\nimport { liveInjectKey } from \"./use\"\n\n\nfunction mapValues(object, cb) {\n    return Object.entries(object).reduce((acc, [key, value]) => {\n        acc[key] = cb(value, key, object);\n        return acc;\n    }, {});\n}\n\nfunction getAttributeJson(el, attributeName) {\n    const data = el.getAttribute(attributeName)\n    return data ? JSON.parse(data) : {}\n}\n\nfunction getSlots(el) {\n    const dataSlots = getAttributeJson(el, \"data-slots\")\n    return mapValues(\n        dataSlots, \n        base64 => () => h('div', {innerHTML: atob(base64).trim()})\n    )\n}\n\nfunction getHandlers(el, liveSocket) {\n    const handlers = getAttributeJson(el, \"data-handlers\")\n    const result = {}\n    for (const handlerName in handlers) {\n        const ops = handlers[handlerName]\n        const snakeCaseName = `on${handlerName.charAt(0).toUpperCase() + handlerName.slice(1)}`\n        result[snakeCaseName] = (event) => {\n            // a little bit of magic to replace the event with the value of the input\n            const parsedOps = JSON.parse(ops)\n            const replacedOps = parsedOps.map(([op, args, ...other]) => {\n                if (op === 'push' && !args.value) args.value = event\n                return [op, args, ...other]\n            })\n            liveSocket.execJS(el, JSON.stringify(replacedOps))\n        }\n    }\n    return result\n}\n\nfunction getProps(el, liveSocket) {\n    return {\n        ...getAttributeJson(el, \"data-props\"),\n        ...getHandlers(el, liveSocket),\n    }\n}\n\nexport function getHooks(components) {\n    const VueHook = {\n        mount(el, liveSocket) {\n            const componentName = el.getAttribute(\"data-name\")\n            const component = components[componentName]\n            \n            if (!component) {\n                console.error(`Component ${componentName} not found`)\n                return\n            }\n\n            const makeApp = el.getAttribute(\"data-ssr\") === \"true\" ? createSSRApp : createApp\n\n            el._props = reactive(getProps(el, liveSocket))\n            el._slots = reactive(getSlots(el))\n\n            el._instance = makeApp({ render: () => h(component, el._props, el._slots) })\n            el._instance.provide(liveInjectKey, this)\n            el._instance.mount(el)\n        },\n        mounted() {\n            this.mount(this.el, this.liveSocket)\n        },\n        updated() {\n            Object.assign(this.el._props, getProps(this.el, this.liveSocket))\n            Object.assign(this.el._slots, getSlots(this.el))\n        },\n        destroyed() {\n            window.addEventListener(\"phx:page-loading-stop\", () => this.el._instance.unmount(), {once: true})\n        },\n    }\n\n    return {\n        VueHook,\n    }\n}\n", "import {inject} from \"vue\"\n\nexport const liveInjectKey = Symbol()\n\nexport function useLiveVue() {\n  // provided by hook\n  return inject(liveInjectKey)\n}"],
  "mappings": ";AAAA,SAAS,WAAW,cAAc,UAAU,GAAG,KAAK,gBAAgB;;;ACApE,SAAQ,cAAa;AAEd,IAAM,gBAAgB,OAAO;AAE7B,SAAS,aAAa;AAE3B,SAAO,OAAO,aAAa;AAC7B;;;ADHA,SAAS,UAAU,QAAQ,IAAI;AAC3B,SAAO,OAAO,QAAQ,MAAM,EAAE,OAAO,CAAC,KAAK,CAAC,KAAK,KAAK,MAAM;AACxD,QAAI,GAAG,IAAI,GAAG,OAAO,KAAK,MAAM;AAChC,WAAO;AAAA,EACX,GAAG,CAAC,CAAC;AACT;AAEA,SAAS,iBAAiB,IAAI,eAAe;AACzC,QAAM,OAAO,GAAG,aAAa,aAAa;AAC1C,SAAO,OAAO,KAAK,MAAM,IAAI,IAAI,CAAC;AACtC;AAEA,SAAS,SAAS,IAAI;AAClB,QAAM,YAAY,iBAAiB,IAAI,YAAY;AACnD,SAAO;AAAA,IACH;AAAA,IACA,YAAU,MAAM,EAAE,OAAO,EAAC,WAAW,KAAK,MAAM,EAAE,KAAK,EAAC,CAAC;AAAA,EAC7D;AACJ;AAEA,SAAS,YAAY,IAAI,YAAY;AACjC,QAAM,WAAW,iBAAiB,IAAI,eAAe;AACrD,QAAM,SAAS,CAAC;AAChB,aAAW,eAAe,UAAU;AAChC,UAAM,MAAM,SAAS,WAAW;AAChC,UAAM,gBAAgB,KAAK,YAAY,OAAO,CAAC,EAAE,YAAY,IAAI,YAAY,MAAM,CAAC;AACpF,WAAO,aAAa,IAAI,CAAC,UAAU;AAE/B,YAAM,YAAY,KAAK,MAAM,GAAG;AAChC,YAAM,cAAc,UAAU,IAAI,CAAC,CAAC,IAAI,MAAS,QAAK,MAAM;AACxD,YAAI,OAAO,UAAU,CAAC,KAAK;AAAO,eAAK,QAAQ;AAC/C,eAAO,CAAC,IAAI,MAAM,GAAG,KAAK;AAAA,MAC9B,CAAC;AACD,iBAAW,OAAO,IAAI,KAAK,UAAU,WAAW,CAAC;AAAA,IACrD;AAAA,EACJ;AACA,SAAO;AACX;AAEA,SAAS,SAAS,IAAI,YAAY;AAC9B,SAAO;AAAA,IACH,GAAG,iBAAiB,IAAI,YAAY;AAAA,IACpC,GAAG,YAAY,IAAI,UAAU;AAAA,EACjC;AACJ;AAEO,SAAS,SAAS,YAAY;AACjC,QAAM,UAAU;AAAA,IACZ,MAAM,IAAI,YAAY;AAClB,YAAM,gBAAgB,GAAG,aAAa,WAAW;AACjD,YAAM,YAAY,WAAW,aAAa;AAE1C,UAAI,CAAC,WAAW;AACZ,gBAAQ,MAAM,aAAa,yBAAyB;AACpD;AAAA,MACJ;AAEA,YAAM,UAAU,GAAG,aAAa,UAAU,MAAM,SAAS,eAAe;AAExE,SAAG,SAAS,SAAS,SAAS,IAAI,UAAU,CAAC;AAC7C,SAAG,SAAS,SAAS,SAAS,EAAE,CAAC;AAEjC,SAAG,YAAY,QAAQ,EAAE,QAAQ,MAAM,EAAE,WAAW,GAAG,QAAQ,GAAG,MAAM,EAAE,CAAC;AAC3E,SAAG,UAAU,QAAQ,eAAe,IAAI;AACxC,SAAG,UAAU,MAAM,EAAE;AAAA,IACzB;AAAA,IACA,UAAU;AACN,WAAK,MAAM,KAAK,IAAI,KAAK,UAAU;AAAA,IACvC;AAAA,IACA,UAAU;AACN,aAAO,OAAO,KAAK,GAAG,QAAQ,SAAS,KAAK,IAAI,KAAK,UAAU,CAAC;AAChE,aAAO,OAAO,KAAK,GAAG,QAAQ,SAAS,KAAK,EAAE,CAAC;AAAA,IACnD;AAAA,IACA,YAAY;AACR,aAAO,iBAAiB,yBAAyB,MAAM,KAAK,GAAG,UAAU,QAAQ,GAAG,EAAC,MAAM,KAAI,CAAC;AAAA,IACpG;AAAA,EACJ;AAEA,SAAO;AAAA,IACH;AAAA,EACJ;AACJ;",
  "names": []
}
